{% extends 'layout.html' %}

{% block title %}
    {{ tournament.name }}
{% endblock %}

{% block content %}
    <h1>{{ tournament.name }}</h1>

    <div class="theme theme-dark">
        <div class="bracket disable-image">
            <div class="column last-32">
                <h2>Last 32</h2>
                {% for game in rounds.last_32 %}
                    <div class="match last-32-match {% if game.winner and game.winner == game.player1 %}winner-top{% elif game.winner and game.winner == game.player2 %}winner-bottom{% endif %}" data-match-id="{{ game.id }}">
                        <div class="match-top team">
                            <span class="seed">{{ forloop.counter }}</span> <span class="name">{{ game.player1.username }}</span>
                            {% if game.winner %}
                                <span class="score">{{ game.score1 }}</span>
                            {% endif %}
                        </div>
                        <div class="match-bottom team">
                            <span class="name">
                                {% if game.player2 %}
                                    {{ game.player2.username }}
                                {% else %}
                                    TBD
                                {% endif %}
                            </span>
                            {% if game.winner %}
                                <span class="score">{{ game.score2 }}</span>
                            {% endif %}
                        </div>
                        <a href="{% url 'tournaments:update_match_view' tournament_name=tournament.name match_id=game.id %}">Edit</a>
                        {% if game.winner %}
                            <div class="match-lines">
                                <div class="line one"></div>
                                <div class="line two"></div>
                            </div>
                            <div class="match-lines alt">
                                <div class="line one"></div>
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
            <div class="column last-16">
                <h2>Last 16</h2>
                {% for game in rounds.last_16 %}
                    <div class="match last-16-match {% if game.winner and game.winner == game.player1 %}winner-top{% elif game.winner and game.winner == game.player2 %}winner-bottom{% endif %}" data-match-id="{{ game.id }}">
                        <div class="match-top team">
                            <span class="seed">{{ forloop.counter }}</span> <span class="name">{{ game.player1.username }}</span>
                            {% if game.winner %}
                                <span class="score">{{ game.score1 }}</span>
                            {% endif %}
                        </div>
                        <div class="match-bottom team">
                            <span class="seed">
                                {% if game.player2 %}
                                    {{ game.player2.username }}
                                {% else %}
                                    TBD
                                {% endif %}
                            </span>
                            {% if game.winner %}
                                <span class="score">{{ game.score2 }}</span>
                            {% endif %}
                        </div>
                        <a href="{% url 'tournaments:update_match_view' tournament_name=tournament.name match_id=game.id %}">Edit</a>
                        {% if game.winner %}
                            <div class="match-lines">
                                <div class="line one"></div>
                                <div class="line two"></div>
                            </div>
                            <div class="match-lines alt">
                                <div class="line one"></div>
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
            <div class="column quarters">
                <h2>Quarter-Finals</h2>
                {% for game in rounds.quarters %}
                    <div class="match quarter-match {% if game.winner and game.winner == game.player1 %}winner-top{% elif game.winner and game.winner == game.player2 %}winner-bottom{% endif %}" data-match-id="{{ game.id }}">
                        <div class="match-top team">
                            <span class="seed">{{ forloop.counter }}</span> <span class="name">{{ game.player1.username }}</span>
                            {% if game.winner %}
                                <span class="score">{{ game.score1 }}</span>
                            {% endif %}
                        </div>
                        <div class="match-bottom team">
                            <span class="seed">
                                {% if game.player2 %}
                                    {{ game.player2.username }}
                                {% else %}
                                    TBD
                                {% endif %}
                            </span>
                            {% if game.winner %}
                                <span class="score">{{ game.score2 }}</span>
                            {% endif %}
                        </div>
                        <a href="{% url 'tournaments:update_match_view' tournament_name=tournament.name match_id=game.id %}">Edit</a>
                        {% if game.winner %}
                            <div class="match-lines">
                                <div class="line one"></div>
                                <div class="line two"></div>
                            </div>
                            <div class="match-lines alt">
                                <div class="line one"></div>
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
            <div class="column semis">
                <h2>Semi-Finals</h2>
                {% for game in rounds.semis %}
                    <div class="match semi-match {% if game.winner and game.winner == game.player1 %}winner-top{% elif game.winner and game.winner == game.player2 %}winner-bottom{% endif %}" data-match-id="{{ game.id }}">
                        <div class="match-top team">
                            <span class="seed">{{ forloop.counter }}</span> <span class="name">{{ game.player1.username }}</span>
                            {% if game.winner %}
                                <span class="score">{{ game.score1 }}</span>
                            {% endif %}
                        </div>
                        <div class="match-bottom team">
                            <span class="seed">
                                {% if game.player2 %}
                                    {{ game.player2.username }}
                                {% else %}
                                    TBD
                                {% endif %}
                            </span>
                            {% if game.winner %}
                                <span class="score">{{ game.score2 }}</span>
                            {% endif %}
                        </div>
                        <a href="{% url 'tournaments:update_match_view' tournament_name=tournament.name match_id=game.id %}">Edit</a>
                        {% if game.winner %}
                            <div class="match-lines">
                                <div class="line one"></div>
                                <div class="line two"></div>
                            </div>
                            <div class="match-lines alt">
                                <div class="line one"></div>
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
            <div class="column finals">
                <h2>Final</h2>
                {% for game in rounds.final %}
                    <div class="match final-match {% if game.winner and game.winner == game.player1 %}winner-top{% elif game.winner and game.winner == game.player2 %}winner-bottom{% endif %}" data-match-id="{{ game.id }}">
                        <div class="match-top team">
                            <span class="seed">{{ forloop.counter }}</span> <span class="name">{{ game.player1.username }}</span>
                            {% if game.winner %}
                                <span class="score">{{ game.score1 }}</span>
                            {% endif %}
                        </div>
                        <div class="match-bottom team">
                            <span class="seed">
                                {% if game.player2 %}
                                    {{ game.player2.username }}
                                {% else %}
                                    TBD
                                {% endif %}
                            </span>
                            {% if game.winner %}
                                <span class="score">{{ game.score2 }}</span>
                            {% endif %}
                        </div>
                        <a href="{% url 'tournaments:update_match_view' tournament_name=tournament.name match_id=game.id %}">Edit</a>
                        {% if game.winner %}
                            <div class="match-lines">
                                <div class="line one"></div>
                                <div class="line two"></div>
                            </div>
                            <div class="match-lines alt">
                                <div class="line one"></div>
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
            <div class="column winner">
                <h2>Winner</h2>
                {% if rounds.final.0.winner %}
                <div class="winner-name">{{ rounds.final.0.winner.username }}</div>
                {% endif %}
            </div>
        </div>
    </div>

    <div id="match-edit-popup" class="popup">
        <div class="popup-content">
            <span class="close-button">&times;</span>
            <h2>Edit Match</h2>
            <form id="match-edit-form">
                <input type="hidden" id="match-id" name="match_id">
                <label for="winner">Winner:</label>
                <select id="winner" name="winner">
                    <option value="">Select Winner</option>
                    <option value="{{ game.player1.id }}">{{ game.player1.username }}</option> {## Example options #}
                    <option value="{{ game.player2.id }}">{{ game.player2.username }}</option>
                </select>
                <label for="score1">Score 1:</label>
                <input type="number" id="score1" name="score1">
                <label for="score2">Score 2:</label>
                <input type="number" id="score2" name="score2">
                <button type="submit">Submit</button>
            </form>
        </div>
    </div>
{% endblock %}